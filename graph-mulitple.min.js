const graphs=document.querySelectorAll(".round-pie-chart");async function fetchData(){for(let t=0;t<graphs.length;t++){const s=graphs[t],e=s.getAttribute("data-folder");var a=`./${e}/config.json`;await fetch(a).then(t=>t.json()).then(t=>{let r,n,o;r=t.groups,n=t.groupsDisplayNames,csvFiles=t.csvFiles,o=t.colors,console.log(csvFiles);t=`./${e}/`+csvFiles.dates;const l=`./${e}/`+csvFiles.data;console.log(t,l),d3.csv(t).then(function(a){let e=[];for(let t=0;t<a.length;t++)e.push(a[t].date);d3.csv(l).then(function(t){doGraph(t,e,s,r,n,o)})})})}}function doGraph(t,n,a,r,o,l){const e=62.5,s=e,i=e,d=e,p=e,c=1e3-p-i,h=1e3-s-d,u=10,f=Math.min(c,h)/2-100;const g=d3.select(a).append("svg").attr("width",c+p+i+100).attr("height",h+s+d+100).append("g").attr("transform",`translate(${c/2+p+50}, ${h/2+s+50}) rotate(0) `);let m=new Array;t.forEach((a,t)=>{a.Group=o[a.country];var e=r.findIndex(t=>t===a.country);a.Color=l[e],a.Name=a.name,a.Value=a.values.split(",").map(t=>parseFloat(t)),m&&!m.find(t=>t.Name===a.name)&&m.push(a)});const y=d3.scaleBand().range([0,2*Math.PI]).align(0).domain(m.map(t=>t.Name)),x=d3.scaleRadial().range([u,f]).domain([0,400]);d3.scaleLinear().domain([0,1]).range(["0","255"]);numOfEntries=m[0].Value.length;const v=(f-u-30)/numOfEntries,b=(d3.range(0,numOfEntries,1).forEach((t,e)=>{var a=g.append("g").selectAll("path").data(m).join("path").attr("fill",t=>{var a=t.Value[e]/100;return"empty"===t.type?"rgba(255,255,255,0)":`rgba(${t.Color},${a})`}).attr("d",d3.arc().innerRadius((t,a)=>u+e*v).outerRadius((t,a)=>{return u+(e+1)*v}).startAngle(t=>y(t.Name)).endAngle(t=>y(t.Name)+y.bandwidth()).padAngle(.01).padRadius(u)),r=n[e];a.append("title").text(""+r)}),g.append("g").selectAll("g").data(m).join("g").attr("text-anchor",function(t){return(y(t.Name)+y.bandwidth()/2+Math.PI)%(2*Math.PI)<Math.PI?"end":"start"}).attr("transform",function(t){return"rotate("+(180*(y(t.Name)+y.bandwidth()/2)/Math.PI-90)+")translate("+(x(f-e+f/5)+30)+",0)"}).append("text").text(function(t){var a=parseFloat(t.factor).toFixed(2),e=1<a?" ⭐":"  ",r="trainer"===t.type;return r?"🎩 "+t.Name.split(" /")[0]+" 🎩":"empty"===t.type?"":a+" "+(r?"":t.position)+" "+t.Name+e}).attr("class",function(t){return t.Group}).attr("transform",function(t){return(y(t.Name)+y.bandwidth()/2+Math.PI)%(2*Math.PI)<Math.PI?"rotate(180)":"rotate(0)"}).style("font-size","14px").style("font-weight",function(t){return"trainer"===t.type?"bold":"normal"}).attr("alignment-baseline","middle"),[]);r.forEach((a,t)=>{var e=m.filter(t=>t.country===a);if(e[0]){var r=e[0].name;const n=e[e.length-1].name;let t=m.findIndex(t=>t.name===n)+1;t>=m.length-1&&(t=0),b.push({Group:a,Start:r,End:n,StartX:y(r)+y.bandwidth()/4,EndX:y(m[t].name)})}}),g.append("g").attr("class","group-lines").attr("transform","rotate(-90)").selectAll("path").data(b).join("path").attr("stroke",(t,a)=>"empty"===t.Group?"rgb(255,255,255)":`rgb(${l[a]})`).attr("class",t=>"line-"+t.Group).attr("fill","none").attr("stroke-width",3).attr("stroke-linecap","round").attr("id",t=>t.Group.replace(" ","").toLowerCase()).attr("d",(t,a)=>{var e,r,n;if("empty"!==t.type)return e=d3.path(),n=(r=t.EndX>Math.PI)?t.EndX:t.StartX,t=r?t.StartX:t.EndX,e.arc(0,0,f-5,+n,+t,r),e}),g.append("g").attr("class","group-labels").attr("transform","rotate(-90)").selectAll("g").data(b).enter().append("g").attr("class","group-label-text").attr("transform-origin","center").append("text").attr("text-anchor","middle").attr("dy",t=>t.EndX>Math.PI?-8:16).append("textPath").attr("xlink:href",t=>"#"+t.Group.replace(" ","").toLowerCase()).attr("startOffset","50%").style("font-size","16px").attr("fill",(t,a)=>"rgb("+l[a]).text(t=>o[t.Group]);var w,I,E=n,M=E.length,N=(f-u-30)/M,P=Math.floor(M/6);for(let t=0;t<M;t++)t%P==0&&(w=(I=E[t].split("-"))[1],parseInt(I[1]),I=I[2]+"-"+w,w=u+(t+1)*N,(w=g.append("text").attr("x",w).attr("y",0).attr("text-anchor","middle").text(I).style("font-size","11px").style("font-weight","bold").attr("fill","white").attr("transform","rotate(-1)")).append("title").text(E[t]),I=w.node().getBBox(),g.append("rect","text").attr("x",I.x).attr("y",I.y).attr("width",I.width+4).attr("height",I.height).attr("transform","translate(-2, 0) rotate(-1)").style("fill","black"),w.raise())}fetchData();