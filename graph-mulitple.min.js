const graphs=document.querySelectorAll(".round-pie-chart");async function fetchData(){for(let t=0;t<graphs.length;t++){const l=graphs[t],e=l.getAttribute("data-folder");var a=`./${e}/config.json`;await fetch(a).then(t=>t.json()).then(t=>{let r,n,o;r=t.groups,n=t.groupsDisplayNames,csvFiles=t.csvFiles,o=t.colors;t=`./${e}/`+csvFiles.dates;const i=`./${e}/`+csvFiles.data;d3.csv(t).then(function(a){let e=[];for(let t=0;t<a.length;t++)e.push(a[t].date);d3.csv(i).then(function(t){doGraph(t,e,l,r,n,o)})})})}}function doGraph(t,n,a,r,s,d){const e=62.5,o=e,i=e,l=e,h=e,p=1e3-h-i,c=1e3-o-l,u=10,f=Math.min(p,c)/2-100;const g=d3.select(a).append("svg").attr("width",p+h+i+100).attr("height",c+o+l+100).append("g").attr("transform",`translate(${p/2+h+50}, ${c/2+o+50}) rotate(0) `);let m=new Array;t.forEach((a,t)=>{a.Group=s[a.country];var e=r.findIndex(t=>t===a.country);a.Color=d[e],a.Name=a.name,a.Value=a.values.split(",").map(t=>parseFloat(t)),m&&!m.find(t=>t.Name===a.name)&&m.push(a)});const x=d3.scaleBand().range([0,2*Math.PI]).align(0).domain(m.map(t=>t.Name)),y=d3.scaleRadial().range([u,f]).domain([0,400]);d3.scaleLinear().domain([0,1]).range(["0","255"]);numOfEntries=m[0].Value.length;const w=(f-u-30)/numOfEntries,v=(d3.range(0,numOfEntries,1).forEach((t,e)=>{var a=g.append("g").selectAll("path").data(m).join("path").attr("fill",t=>{var a=t.Value[e]/100;return"empty"===t.type?"rgba(255,255,255,0)":`rgba(${t.Color},${a})`}).attr("d",d3.arc().innerRadius((t,a)=>u+e*w).outerRadius((t,a)=>{return u+(e+1)*w}).startAngle(t=>x(t.Name)).endAngle(t=>x(t.Name)+x.bandwidth()).padAngle(.01).padRadius(u)),r=n[e];a.append("title").text(""+r)}),g.append("g").selectAll("g").data(m).join("g").attr("text-anchor",function(t){return(x(t.Name)+x.bandwidth()/2+Math.PI)%(2*Math.PI)<Math.PI?"end":"start"}).attr("transform",function(t){return"rotate("+(180*(x(t.Name)+x.bandwidth()/2)/Math.PI-90)+")translate("+(y(f-e+f/5)+30)+",0)"}).append("text").text(function(t){var a=parseFloat(t.factor).toFixed(2),e=1<a?" ⭐":"  ",r="trainer"===t.type;return r?"🎩 "+t.Name.split(" /")[0]+" 🎩":"empty"===t.type?"":a+" "+(r?"":t.position)+" "+t.Name+e}).attr("class",function(t){return t.Group}).attr("transform",function(t){return(x(t.Name)+x.bandwidth()/2+Math.PI)%(2*Math.PI)<Math.PI?"rotate(180)":"rotate(0)"}).style("font-size","14px").style("font-weight",function(t){return"trainer"===t.type?"bold":"normal"}).attr("alignment-baseline","middle"),[]);r.forEach((a,t)=>{var e=m.filter(t=>t.country===a);if(e[0]){var r=e[0].name;const n=e[e.length-1].name;let t=m.findIndex(t=>t.name===n)+1;t>=m.length-1&&(t=0),v.push({Group:a,Start:r,End:n,StartX:x(r)+x.bandwidth()/4,EndX:x(m[t].name)})}}),g.append("g").attr("class","group-lines").attr("transform","rotate(-90)").selectAll("path").data(v).join("path").attr("stroke",(t,a)=>"empty"===t.Group?"rgb(255,255,255)":`rgb(${d[a]})`).attr("class",t=>"line-"+t.Group).attr("fill","none").attr("stroke-width",3).attr("stroke-linecap","round").attr("id",t=>t.Group.replace(" ","").toLowerCase()).attr("d",(t,a)=>{var e,r,n;if("empty"!==t.type)return e=d3.path(),n=(r=t.EndX>Math.PI)?t.EndX:t.StartX,t=r?t.StartX:t.EndX,e.arc(0,0,f-5,+n,+t,r),e}),g.selectAll(".text-group").data(v).enter().append("g").attr("class","text-group").each(function(t,a){var e=d3.select(this),r=e.append("text").text(t=>s[t.Group]).attr("font-size","20px").attr("fill",function(t){return"rgb("+d[a]}).attr("text-anchor","middle"),n=r.node().getBBox(),t=(e.attr("width",n.width).attr("height",n.height),e.append("rect").attr("fill","white").attr("width",n.width+10).attr("height",n.height+10).attr("x",n.x-5).attr("y",n.y),(t.StartX+t.EndX)/2),o=320*Math.sin(t);let i=-320*Math.cos(t);n.width,i,n.height;n=t*(180/Math.PI);let l=`rotate(${2+n}, 0,0)`;90<n&&n<270&&(l=`rotate(${180+n}, 0,0)`,i+=20),e.attr("transform",`translate(${o}, ${i}) `+l),r.raise()});var b,M,I=n,E=I.length,$=(f-u-30)/E,N=Math.floor(E/6);for(let t=0;t<E;t++)t%N==0&&(b=(M=I[t].split("-"))[1],parseInt(M[1]),M=M[2]+"-"+b,b=u+(t+1)*$,(b=g.append("text").attr("x",b).attr("y",0).attr("text-anchor","middle").text(M).style("font-size","11px").style("font-weight","bold").attr("fill","white").attr("transform","rotate(-1)")).append("title").text(I[t]),M=b.node().getBBox(),g.append("rect","text").attr("x",M.x).attr("y",M.y).attr("width",M.width+4).attr("height",M.height).attr("transform","translate(-2, 0) rotate(-1)").style("fill","black"),b.raise())}fetchData();